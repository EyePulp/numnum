<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Math for Emma</title>
        <script src="https://unpkg.com/alpinejs" defer></script>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body class="px-20 py-20">
        <h1 class="text-5xl font-bold underline">Emma's Math Extravaganza</h1>
        <div x-data="mathInit" x-init="createProblem">
            <template x-if="!checked">
                <div class="mx-10 my-20 flex justify-between p-5">
                    <template x-for="(bit, i) in expression" :key="i">
                        <span x-text="bit" class="px-2 text-3xl"></span>
                    </template>

                    Your answer:
                    <input type="text" size="4" class="border-zinc-600 border" x-model="myAnswer" />

                    <button
                        @click="checkAnswer"
                        class="border-zinc-600 bg-zinc-300 rounded-md border p-0.5 text-xl"
                    >
                        Check!
                    </button>
                </div>
            </template>

            <template x-if="checked">
                <div>
                    <template x-if="checkMath()">
                        <div class="mx-10 my-20 flex items-center justify-between p-5">
                            <div class="text-5xl">Correct!</div>

                            <div
                                class="inline-flex h-24 w-24 items-center justify-center rounded-full border-4 border-green-200 bg-green-400"
                            >
                                <span
                                    x-text="answer"
                                    class="text-5xl font-medium leading-none text-white"
                                ></span>
                            </div>
                            <button
                                @click="createProblem"
                                class="border-zinc-600 bg-zinc-300 rounded-md border p-0.5 text-xl"
                            >
                                Next Problem!
                            </button>
                        </div>
                    </template>
                    <template x-if="!checkMath()">
                        <div class="mx-10 my-20 flex items-center justify-between p-5">
                            <div class="text-5xl">Nope!</div>

                            <div
                                class="border-red-200 bg-red-400 inline-flex h-24 w-24 items-center justify-center rounded-full border-4"
                            >
                                <span
                                    x-text="answer"
                                    class="text-5xl font-medium leading-none text-white"
                                ></span>
                            </div>
                            <button
                                @click="createProblem"
                                class="border-zinc-600 bg-zinc-300 rounded-md border p-0.5 text-xl"
                            >
                                Next Problem!
                            </button>
                        </div>
                    </template>
                </div>
            </template>

            <div class="flex justify-between">
                <div class="text-2xl">
                    Incorrect:
                    <div
                        class="border-red-200 bg-red-400 inline-flex h-8 w-8 items-center justify-center rounded-full border-4"
                    >
                        <span
                            x-text="totalWrong"
                            class="text-xl font-medium leading-none text-white"
                        ></span>
                    </div>
                </div>
                <div class="text-2xl">
                    Correct:
                    <div
                        class="inline-flex h-8 w-8 items-center justify-center rounded-full border-4 border-green-200 bg-green-400"
                    >
                        <span
                            x-text="totalCorrect"
                            class="text-xl font-medium leading-none text-white"
                        ></span>
                    </div>
                </div>
            </div>
        </div>
        <script>
            function mathInit() {
                function rndInt(min, max) {
                    min = Math.ceil(min);
                    max = Math.floor(max);
                    return Math.floor(Math.random() * (max - min) + min); // The maximum is exclusive and the minimum is inclusive
                }

                return {
                    expression: [],
                    answer: null,
                    myAnswer: '',
                    checked: false,
                    totalCorrect: 0,
                    totalWrong: 0,

                    createProblem() {
                        const numCount = rndInt(2, 5);
                        const nums = Array.from({ length: numCount }, () => rndInt(0, 21));
                        const ops = Array.from({ length: numCount - 1 }, () => rndInt(0, 2));

                        this.myAnswer = '';
                        this.checked = false;
                        this.expression = [
                            ...nums
                                .reduce((arr, v, i) => {
                                    return arr.concat(v, ops[i] === 0 ? '-' : '+');
                                }, [])
                                .slice(0, -1),
                        ];

                        let lastOp = null;
                        this.answer = this.expression.reduce((t, bit) => {
                            switch (bit) {
                                case '+':
                                    lastOp = 1;
                                    break;
                                case '-':
                                    lastOp = -1;
                                    break;
                                default:
                                    if (lastOp !== null) {
                                        t = t + lastOp * bit;
                                        lastOp = null;
                                    } else {
                                        t = bit;
                                    }
                            }
                            console.log(bit, t);
                            return t;
                        }, 0);
                        console.log({ exp: this.expression, ans: this.answer });
                    },
                    checkMath() {
                        return parseInt(this.myAnswer) === this.answer;
                    },
                    checkAnswer() {
                        this.checked = true;
                        if (this.checkMath()) {
                            this.totalCorrect += 1;
                        } else {
                            this.totalWrong += 1;
                        }
                    },
                };
            }
        </script>
    </body>
</html>
